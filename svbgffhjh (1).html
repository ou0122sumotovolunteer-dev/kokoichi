<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°ãƒšãƒ¼ã‚¸ï¼ˆãƒ•ãƒ«è¡¨ç¤ºï¼‰</title>
<style>
  :root { --bg:#f5f7fb; --card:#fff; --accent:#ff3b30; --line:#dfe4ee; }
  body{margin:0;font-family:system-ui,-apple-system,"Hiragino Kaku Gothic ProN";background:var(--bg);color:#222;}

  .hero{
    width:100%;
    height:280px;
    background:#ccc center/cover no-repeat;
    border-radius:0 0 28px 28px;
    box-shadow:0 4px 24px rgba(0,0,0,0.05);
  }

  .wrap{
    max-width:820px;
    margin:0 auto;
    padding:20px;
  }

  h1{margin:0;font-size:28px;padding-top:12px;font-weight:700;}
  .time-place{margin-top:10px;color:#555;font-size:15px;}

  .pill-box{margin-top:14px;}
  .pill{
    display:inline-block;
    padding:6px 10px;
    border-radius:999px;
    background:#eef4ff;
    border:1px solid #d6e2ff;
    color:#234;
    font-size:13px;
    margin-right:6px;
  }

  .section{margin-top:26px;padding:20px;background:var(--card);border-radius:16px;box-shadow:0 4px 14px rgba(0,0,0,0.06);}  
  .section h2{margin:0 0 12px 0;font-size:20px;}
  .section p{margin:0;line-height:1.6;color:#444;}

  .actions{
    margin-top:20px;
    display:grid;
    grid-template-columns:repeat(4,1fr);
    gap:14px;
  }
  .btn{
    background:#f4f6fa;
    padding:14px;
    border-radius:14px;
    text-align:center;
    font-size:15px;
    cursor:pointer;
    border:1px solid #e3e7ef;
    transition:0.2s;
  }
  .btn:hover{background:#e9eef7;}

  .favorite-active{
    background:#ffeaf0;
    border-color:#ffb8c6;
  }

  /* not-found */
  .notfound{max-width:720px;margin:36px auto;padding:24px;background:#fff;border-radius:12px;text-align:center;border:1px solid var(--line);}
  .notfound h2{margin:0 0 8px 0}
  .notfound p{color:#666}
</style>
</head>
<body>

<div id="hero" class="hero" aria-hidden="true"></div>

<div class="wrap" id="contentWrap">
  <h1 id="evTitle">ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒˆãƒ«</h1>
  <div class="time-place" id="evTimePlace"></div>
  <div class="pill-box" id="evCategory"></div>

  <div class="actions">
    <div class="btn" id="favBtn">â¤ ãŠæ°—ã«å…¥ã‚Š</div>
    <div class="btn" id="shareBtn">ğŸ”— å…±æœ‰ï¼ˆãƒ•ãƒ«ï¼‰</div>
    <div class="btn" id="shareSelectBtn">ğŸ”— å…±æœ‰ï¼ˆé¸æŠï¼‰</div>
    <div class="btn" id="gcalBtn">ğŸ—“ Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</div>
  </div>

  <!-- å…±æœ‰é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="shareModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.4);z-index:9999;align-items:center;justify-content:center;">
  <div style="background:#fff;padding:24px;max-width:400px;width:90%;border-radius:16px;box-shadow:0 6px 24px rgba(0,0,0,0.2);text-align:center;">
    <h3 style="margin-top:0;">å…±æœ‰ãƒªãƒ³ã‚¯ã‚’é¸æŠ</h3>
    <p style="color:#555;line-height:1.4;">
      ã©ã®å½¢å¼ã§å…±æœ‰ã—ã¾ã™ã‹ï¼Ÿ<br>
      <strong>ãƒ•ãƒ«ãƒšãƒ¼ã‚¸</strong>ï¼šè©³ç´°æƒ…å ±ã™ã¹ã¦è¡¨ç¤º<br>
      <strong>ã‚µãƒ–ãƒšãƒ¼ã‚¸</strong>ï¼šç°¡æ˜“çš„ãªè¡¨ç¤º
    </p>
    <div style="margin-top:20px;display:flex;gap:12px;justify-content:center;">
      <button id="shareFullBtn" style="flex:1;padding:10px 0;border:none;border-radius:10px;background:#ff3b30;color:#fff;font-weight:600;cursor:pointer;">ãƒ•ãƒ«ãƒšãƒ¼ã‚¸</button>
      <button id="shareSubBtn" style="flex:1;padding:10px 0;border:none;border-radius:10px;background:#f4f6fa;color:#222;font-weight:600;cursor:pointer;">ã‚µãƒ–ãƒšãƒ¼ã‚¸</button>
    </div>
    <button id="shareCloseBtn" style="margin-top:16px;padding:6px 12px;border:none;background:#eee;border-radius:8px;cursor:pointer;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
  </div>
</div>


  <div class="section">
    <h2>æ¦‚è¦</h2>
    <p id="evDesc"></p>
  </div>

  <div class="section">
    <h2>è©³ç´°æƒ…å ±</h2>
    <p id="evDetails"></p>
  </div>
</div>

<script>
// ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚¿ã‚¤ãƒ ãƒ†ãƒ¼ãƒ–ãƒ«ç‰ˆã¨åŒã˜æ§‹é€ ã§é€£æºï¼‰
let events = [
  {id:101,title:'ã‚ªãƒ¼ãƒ—ãƒ‹ãƒ³ã‚°ãƒˆãƒ¼ã‚¯',start:'10:00',end:'10:30',place:'ãƒ¡ã‚¤ãƒ³ãƒ›ãƒ¼ãƒ«',description:'ã‚¤ãƒ™ãƒ³ãƒˆã®ã¯ã˜ã¾ã‚Šã®æŒ¨æ‹¶ã§ã™ã€‚',details:'å‡ºæ¼”è€…: AAA\næŒã¡ç‰©: ç‰¹ã«ãªã—',image:'file:///mnt/data/Screenshot 2025-11-23 22.29.07.png',category:'stage,performance',favorite:false},
  {id:102,title:'ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—A',start:'11:00',end:'12:00',place:'Room A',description:'ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãªãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—',details:'å¯¾è±¡: åˆå¿ƒè€…æ­“è¿\næ³¨æ„: æ±šã‚Œã¦ã‚‚è‰¯ã„æœè£…ã§',image:'file:///mnt/data/Screenshot 2025-11-23 22.34.41.png',category:'kids,performance',favorite:false}
];

// ãŠæ°—ã«å…¥ã‚ŠçŠ¶æ…‹ã‚’åæ˜ 
const favIds = JSON.parse(localStorage.getItem('fav_ids')||'[]');
events.forEach(e=>{ e.favorite = favIds.includes(e.id) });

// URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰å¯¾è±¡ã‚¤ãƒ™ãƒ³ãƒˆã‚’å–å¾—ï¼ˆ?ev=101 or ?id=101ï¼‰
const params = new URLSearchParams(location.search);
const evId = Number(params.get('ev') || params.get('id'));
const ev = events.find(e=>e.id===evId);

// --- æç”» ---
function renderPage(){
  // guard: ev must exist
  if(!ev){
    // show a friendly not-found UI instead of trying to read ev.image
    const wrap = document.getElementById('contentWrap');
    wrap.innerHTML = `\n      <div class="notfound">\n        <h2>ã‚¤ãƒ™ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</h2>\n        <p>æŒ‡å®šã•ã‚ŒãŸã‚¤ãƒ™ãƒ³ãƒˆã¯å­˜åœ¨ã—ãªã„ã‹ã€URLãŒé–“é•ã£ã¦ã„ã¾ã™ã€‚</p>\n        <p>ãƒˆãƒƒãƒ—ã®ã‚¿ã‚¤ãƒ ãƒ†ãƒ¼ãƒ–ãƒ«ã«æˆ»ã‚‹å ´åˆã¯ <a href="/">ã“ã¡ã‚‰</a> ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚</p>\n      </div>\n    `;
    // clear hero background
    const hero = document.getElementById('hero');
    hero.style.backgroundImage = '';
    return;
  }

  const hero = document.getElementById('hero');
  // protect against missing/invalid image
  try{
    if(ev.image) hero.style.backgroundImage = `url('${ev.image}')`;
    else hero.style.backgroundImage = '';
  }catch(e){ hero.style.backgroundImage = ''; }

  document.getElementById('evTitle').textContent = ev.title;
  document.getElementById('evTimePlace').textContent = `${ev.start} - ${ev.end} ï¼ ${ev.place}`;
  document.getElementById('evDesc').textContent = ev.description;
  document.getElementById('evDetails').innerHTML = (ev.details||'').replace(/\n/g,'<br>');

  // ã‚«ãƒ†ã‚´ãƒªãƒ¼
  const catBox = document.getElementById('evCategory');
  catBox.innerHTML = '';
  (ev.category||'').split(',').map(c=>c.trim()).filter(Boolean).forEach(c=>{
    const span=document.createElement('span');
    span.className='pill';
    span.textContent=c;
    catBox.appendChild(span);
  });

  // ãŠæ°—ã«å…¥ã‚Šãƒœã‚¿ãƒ³
  const favBtn = document.getElementById('favBtn');
  favBtn.classList.remove('favorite-active');
  favBtn.textContent = 'â¤ ãŠæ°—ã«å…¥ã‚Š';
  if(ev.favorite){ favBtn.classList.add('favorite-active'); favBtn.textContent='â˜… ãŠæ°—ã«å…¥ã‚Šæ¸ˆ'; }

  favBtn.onclick = ()=>{
    ev.favorite = !ev.favorite;
    const ids = JSON.parse(localStorage.getItem('fav_ids')||'[]');
    if(ev.favorite){ if(!ids.includes(ev.id)) ids.push(ev.id); }
    else{
      const idx = ids.indexOf(ev.id);
      if(idx>=0) ids.splice(idx,1);
    }
    localStorage.setItem('fav_ids',JSON.stringify(ids));
    // update UI without re-running full render to keep stable state
    if(ev.favorite){ favBtn.classList.add('favorite-active'); favBtn.textContent='â˜… ãŠæ°—ã«å…¥ã‚Šæ¸ˆ'; }
    else { favBtn.classList.remove('favorite-active'); favBtn.textContent='â¤ ãŠæ°—ã«å…¥ã‚Š'; }
  };

  // å…±æœ‰ (ãƒ•ãƒ«URL by default)
  document.getElementById('shareBtn').onclick = async ()=>{
    const base = location.origin + location.pathname;
    const fullUrl = `${base}?ev=${ev.id}`;
    const subUrl = `${base}?ev=${ev.id}&mode=sub`;
    if (navigator.share) {
      try { await navigator.share({title:ev.title,text:ev.description,url:fullUrl}); } catch(e){}
    } else { prompt('ãƒ•ãƒ«ãƒšãƒ¼ã‚¸ã®å…±æœ‰ãƒªãƒ³ã‚¯ã§ã™', fullUrl); }
  };

// å…±æœ‰ï¼ˆé¸æŠï¼‰ãƒœã‚¿ãƒ³
document.getElementById('shareSelectBtn').onclick = ()=>{
  const base = location.origin + location.pathname;
  const fullUrl = `${base}?ev=${ev.id}`;
  const subUrl = `${base}?ev=${ev.id}&mode=sub`;

  const modal = document.getElementById('shareModal');
  modal.style.display = 'flex';

  document.getElementById('shareFullBtn').onclick = ()=>{
    prompt('ãƒ•ãƒ«ãƒšãƒ¼ã‚¸ç”¨ã®å…±æœ‰ãƒªãƒ³ã‚¯ã§ã™ã€‚è©³ç´°æƒ…å ±ã‚‚å«ã¾ã‚Œã¾ã™:', fullUrl);
    modal.style.display = 'none';
  };
  document.getElementById('shareSubBtn').onclick = ()=>{
    prompt('ã‚µãƒ–ãƒšãƒ¼ã‚¸ç”¨ã®å…±æœ‰ãƒªãƒ³ã‚¯ã§ã™ã€‚ç°¡æ˜“çš„ãªè¡¨ç¤ºã«ãªã‚Šã¾ã™:', subUrl);
    modal.style.display = 'none';
  };
  document.getElementById('shareCloseBtn').onclick = ()=>{
    modal.style.display = 'none';
  };
};


  // Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼
  document.getElementById('gcalBtn').onclick = ()=>{
    const start = gcalDateTime(ev.start);
    const end = gcalDateTime(ev.end);
    const url = 'https://calendar.google.com/calendar/render?action=TEMPLATE'
      +'&text='+encodeURIComponent(ev.title)
      +'&details='+encodeURIComponent(ev.description)
      +'&location='+encodeURIComponent(ev.place)
      +'&dates='+encodeURIComponent(start+'/'+end);
    window.open(url,'_blank');
  };
}

// Only call renderPage after DOM is ready
if(document.readyState === 'loading'){
  document.addEventListener('DOMContentLoaded', renderPage);
} else { renderPage(); }

// UTCå¤‰æ›
function gcalDateTime(hhmm){
  const [hh,mm]=String(hhmm||'').split(':').map(Number);
  const now=new Date();
  const local=new Date(now.getFullYear(),now.getMonth(),now.getDate(),hh||0,mm||0,0);
  const Y=local.getUTCFullYear();
  const M=String(local.getUTCMonth()+1).padStart(2,'0');
  const D=String(local.getUTCDate()).padStart(2,'0');
  const H=String(local.getUTCHours()).padStart(2,'0');
  const Min=String(local.getUTCMinutes()).padStart(2,'0');
  const S='00';
  return `${Y}${M}${D}T${H}${Min}${S}Z`;
}
</script>
</body>
</html>
